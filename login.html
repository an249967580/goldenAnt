<!doctype html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>éªŒè¯ç ç™»å½• Â· é‡‘èš‚èš</title>
    <meta name="description" content="ä½¿ç”¨é‚®ç®±æˆ–æ‰‹æœºå·éªŒè¯ç å¿«é€Ÿç™»å½•æ¼è›‹ç§‘æŠ€è´¦æˆ·ã€‚" />
    <link rel="stylesheet" href="./dist/output.css" />
    <script src="https://unpkg.com/lucide@0.452.0/dist/umd/lucide.min.js"></script>

    <script type="text/javascript" src="https://o.alicdn.com/yd-cloudauth/cloudauth-cdn/jsvm_all.js"></script>
</head>

<body
    class="min-h-screen bg-gradient-to-br from-slate-50 to-white text-slate-900 dark:from-slate-950 dark:to-slate-900 dark:text-slate-100">
    <header class="border-b bg-white/70 dark:bg-slate-950/50 backdrop-blur">
        <nav class="mx-auto max-w-6xl px-4">
            <div class="flex h-16 items-center justify-between">
                <a href="/index.html" class="flex items-center gap-2">
                    <img src="assets/logo.png" alt="æ¼è›‹ç§‘æŠ€ Logo" class="h-8 w-8 rounded-xl" />
                    <div class="font-bold tracking-tight">é‡‘èš‚èš</div>
                </a>
            </div>
        </nav>
    </header>

    <main class="mx-auto max-w-6xl px-4 py-10 grid lg:grid-cols-2 gap-10 items-center">
        <!-- å·¦ä¾§ä»‹ç» -->
        <section class="hidden lg:block">
            <div class="rounded-3xl border p-8 bg-white/60 dark:bg-slate-900/40">
                <div
                    class="inline-flex items-center gap-2 border rounded-full px-3 py-1 text-sm text-slate-600 dark:text-slate-300">
                    <i data-lucide="shield-check" class="w-4 h-4"></i> å…¬å¹³ç«æŠ€ Â· å®æ—¶åä½œå¼Š
                </div>
                <h1 class="mt-4 text-3xl font-bold leading-tight">
                    éªŒè¯ç ç™»å½•ï¼Œ<span
                        class="bg-gradient-to-r from-emerald-400 to-blue-500 bg-clip-text text-transparent">æ›´å¿«æ·æ›´å®‰å…¨</span>
                </h1>
                <ul class="mt-6 space-y-3 text-slate-600 dark:text-slate-300">
                    <li>âœ… æ”¯æŒé‚®ç®±æˆ–æ‰‹æœºå·ç™»å½•</li>
                    <li>âœ… äº‘ç«¯åŒæ­¥æˆ˜ç»©ä¸ç§°å·</li>
                    <li>âœ… æ— éœ€å¯†ç ï¼Œè¾“å…¥éªŒè¯ç å³å¯ç™»å½•</li>
                </ul>
            </div>
        </section>

        <!-- ç™»å½•å¡ç‰‡ -->
        <section>
            <div
                class="mx-auto max-w-md rounded-3xl border bg-white/80 dark:bg-slate-900/60 backdrop-blur p-8 shadow-card">
                <div class="flex items-center gap-2 mb-4">
                    <img src="assets/logo.png" alt="æ¼è›‹ç§‘æŠ€ Logo" class="h-8 w-8 rounded-xl" />
                    <h2 class="text-xl font-semibold">éªŒè¯ç ç™»å½•</h2>
                </div>

                <!-- é€‰é¡¹å¡ -->
                <div class="mb-4">
                    <div id="login-tabs" class="grid grid-cols-2 rounded-xl border overflow-hidden">
                        <button id="tab-phone" type="button" class="py-2 font-medium transition-colors"
                            aria-selected="true">
                            æ‰‹æœºå·ç™»å½•
                        </button>
                        <button id="tab-email" type="button" class="py-2 font-medium transition-colors"
                            aria-selected="false">
                            é‚®ç®±ç™»å½•
                        </button>
                    </div>
                </div>

                <!-- é‚€è¯·ç  -->
                <div id="invite-box"
                    class="hidden mb-4 p-3 rounded-xl bg-emerald-50 border border-emerald-200 text-emerald-700 text-sm">
                </div>

                <!-- æ‰‹æœºç™»å½• -->
                <form id="form-phone" class="space-y-4">
                    <div>
                        <label class="block text-sm mb-1">æ‰‹æœºå·</label>
                        <input type="tel" name="phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" class="w-full rounded-xl border px-3 py-2"
                            required>
                    </div>
                    <div class="flex gap-2 items-center">
                        <input type="text" name="code" maxlength="6" inputmode="numeric" placeholder="è¾“å…¥éªŒè¯ç "
                            class="w-40 text-left tracking-widest text-base rounded-lg border px-2 py-1" />
                        <button type="button" id="sendPhoneCode" class="btn btn-outline">è·å–éªŒè¯ç </button>
                    </div>
                    <div class="text-sm">
                        <label class="inline-flex items-start gap-2">
                            <input type="checkbox" id="agreePhone" class="mt-1 rounded" required>
                            <span>æˆ‘å·²é˜…è¯»å¹¶åŒæ„ <a href="/agreement.html" class="underline">ç”¨æˆ·åè®®</a> ä¸ <a
                                    href="/privacypolicy.html" class="underline">éšç§æ”¿ç­–</a></span>
                        </label>
                    </div>
                    <button class="btn btn-primary w-full" type="submit">
                        <i data-lucide="log-in" class="w-4 h-4"></i> éªŒè¯å¹¶ç™»å½•
                    </button>
                </form>

                <!-- é‚®ç®±ç™»å½• -->
                <form id="form-email" class="space-y-4 hidden">
                    <div>
                        <label class="block text-sm mb-1">é‚®ç®±</label>
                        <input type="email" name="email" placeholder="name@example.com"
                            class="w-full rounded-xl border px-3 py-2" required>
                    </div>
                    <div class="flex gap-2 items-center">
                        <input type="text" name="code" maxlength="10" inputmode="numeric" placeholder="è¾“å…¥éªŒè¯ç "
                            class="w-40 text-left tracking-widest text-base rounded-lg border px-2 py-1" />
                        <button type="button" id="sendEmailCode" class="btn btn-outline">è·å–éªŒè¯ç </button>
                    </div>
                    <div class="text-sm">
                        <label class="inline-flex items-start gap-2">
                            <input type="checkbox" id="agreeEmail" class="mt-1 rounded" required>
                            <span>æˆ‘å·²é˜…è¯»å¹¶åŒæ„ <a href="/agreement.html" class="underline">ç”¨æˆ·åè®®</a> ä¸ <a
                                    href="/privacypolicy.html" class="underline">éšç§æ”¿ç­–</a></span>
                        </label>
                    </div>
                    <button class="btn btn-primary w-full" type="submit">
                        <i data-lucide="log-in" class="w-4 h-4"></i> éªŒè¯å¹¶ç™»å½•
                    </button>
                </form>
            </div>
        </section>
    </main>

    <footer class="border-t">
        <div class="mx-auto max-w-6xl px-4 py-8 text-sm text-slate-500">Â© <span id="year"></span> GoldenAnt</div>
    </footer>

    <script>
        lucide.createIcons();
        document.getElementById('year').textContent = new Date().getFullYear();

        // åˆ›å»º Toast å®¹å™¨
        const toastContainer = document.createElement('div');
        toastContainer.className = 'fixed top-4 right-4 z-50 space-y-2';
        document.body.appendChild(toastContainer);

        function showToast(message, type = 'info') {
            const colors = {
                success: 'bg-emerald-500 text-white',
                error: 'bg-red-500 text-white',
                info: 'bg-blue-500 text-white',
            };
            const icons = {
                success: 'check-circle',
                error: 'x-circle',
                info: 'info',
            };

            const toast = document.createElement('div');
            toast.className = `flex items-center gap-2 px-4 py-2 rounded-xl shadow-lg opacity-0 translate-y-2 transition-all duration-300 ${colors[type]}`;
            toast.innerHTML = `
        <i data-lucide="${icons[type]}" class="w-4 h-4"></i>
        <span>${message}</span>
    `;

            toastContainer.appendChild(toast);
            // âš ï¸ å¿…é¡»åœ¨ append åè°ƒç”¨ï¼ŒLucide æ‰èƒ½æ¸²æŸ“å‡º SVG å›¾æ ‡
            lucide.createIcons();

            // åŠ¨ç”»è¿›å…¥
            requestAnimationFrame(() => {
                toast.classList.remove('opacity-0', 'translate-y-2');
            });

            // è‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-2');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Tab åˆ‡æ¢
        const tabPhone = document.getElementById('tab-phone');
        const tabEmail = document.getElementById('tab-email');
        const formPhone = document.getElementById('form-phone');
        const formEmail = document.getElementById('form-email');
        function setActive(tabBtn) {
            [tabPhone, tabEmail].forEach(b => {
                b.setAttribute('aria-selected', 'false');
                b.classList.remove('bg-emerald-500', 'text-white');
            });
            tabBtn.setAttribute('aria-selected', 'true');
            tabBtn.classList.add('bg-emerald-500', 'text-white');
        }
        function showPhone() {
            formPhone.classList.remove('hidden');
            formEmail.classList.add('hidden');
            setActive(tabPhone);
        }
        function showEmail() {
            formEmail.classList.remove('hidden');
            formPhone.classList.add('hidden');
            setActive(tabEmail);
        }
        tabPhone.addEventListener('click', showPhone);
        tabEmail.addEventListener('click', showEmail);
        showPhone();

        // é‚€è¯·ç 
        const params = new URLSearchParams(window.location.search);
        const inviteId = params.get('inviteId');
        if (inviteId) {
            const box = document.getElementById('invite-box');
            box.textContent = `é‚€è¯·ç ï¼š${inviteId}`;
            box.classList.remove('hidden');
        }

        // å€’è®¡æ—¶
        function startCountdown(btn) {
            let cd = 60;
            btn.disabled = true;
            btn.textContent = `å·²å‘é€(${cd}s)`;
            const timer = setInterval(() => {
                cd--;
                btn.textContent = `å·²å‘é€(${cd}s)`;
                if (cd <= 0) {
                    clearInterval(timer);
                    btn.disabled = false;
                    btn.innerHTML = '<i data-lucide="send" class="w-4 h-4"></i> é‡æ–°è·å–';
                    lucide.createIcons();
                }
            }, 1000);
        }

        // æ‰‹æœºéªŒè¯ç 
        document.getElementById('sendPhoneCode').addEventListener('click', async () => {
            const phone = formPhone.elements['phone'].value.trim();
            if (!/^1[3-9]\d{9}$/.test(phone)) return showToast('è¯·è¾“å…¥æ­£ç¡®æ‰‹æœºå·', 'error');
            const btn = document.getElementById('sendPhoneCode');
            const oldHtml = btn.innerHTML;
            setLoading(btn, 'å‘é€ä¸­...');
            try {
                const check = await fetch('https://gdclient.7919.cn/api/Login/checkUserExists', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ account: phone, type: 1 })
                });
                const checkData = await check.json();
                if (checkData.code == 200 && checkData.data.exists) {
                    showToast('è¯¥æ‰‹æœºå·å·²æ³¨å†Œ');
                    resetButton(btn, oldHtml);
                    return
                }
                const res = await fetch('https://gdclient.7919.cn/api/Login/sendCode', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ account: phone, type: 1 })
                });
                const data = await res.json();
                if (data.code == 200) { showToast('éªŒè¯ç å·²å‘é€', 'success'); startCountdown(btn); }
                else showToast(data.msg || 'å‘é€å¤±è´¥', 'error');
            } catch { showToast('ç½‘ç»œé”™è¯¯', 'error'); }
        });

        // é‚®ç®±éªŒè¯ç 
        document.getElementById('sendEmailCode').addEventListener('click', async () => {
            const email = formEmail.elements['email'].value.trim();
            const reg = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!reg.test(email)) return showToast('è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±åœ°å€', 'error');
            const btn = document.getElementById('sendEmailCode');
            const oldHtml = btn.innerHTML;
            setLoading(btn, 'å‘é€ä¸­...');
            try {
                const check = await fetch('https://gdclient.7919.cn/api/Login/checkUserExists', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ account: email, type: 2 })
                });
                const checkData = await check.json();
                if (checkData.code == 200 && checkData.data.exists) {
                    showToast('è¯¥é‚®ç®±å·²æ³¨å†Œ');
                    resetButton(btn, oldHtml);
                    return;
                }
                const res = await fetch('https://gdclient.7919.cn/api/Login/sendCode', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ account: email, type: 2 })
                });
                const data = await res.json();
                if (data.code == 200) {
                    showToast('éªŒè¯ç å·²å‘é€', 'success');
                    startCountdown(btn);
                } else {
                    showToast(data.msg || 'å‘é€å¤±è´¥', 'error');
                    resetButton(btn, oldHtml);
                }
            } catch {
                showToast('ç½‘ç»œé”™è¯¯', 'error');
                resetButton(btn, oldHtml);
            }
        });

        // ç™»å½•
        async function handleLogin(account, type, code, btn) {
            btn.disabled = true;
            const oldHtml = btn.innerHTML;
            btn.innerHTML = `<svg class="animate-spin w-4 h-4 mr-2 inline" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
        </svg> ç™»å½•ä¸­...`;
//             showToast('æ­£åœ¨è·å– MetaInfo...');
//             const metaInfo = window.getMetaInfo(); // âœ… è°ƒç”¨é˜¿é‡Œäº‘ SDK è·å–æµè§ˆå™¨è®¾å¤‡æŒ‡çº¹
//             console.log('MetaInfo:', metaInfo);

//             // âœ… æ¨¡æ‹Ÿåç«¯è¿”å›ï¼ˆè¿™é‡Œç›´æ¥æ„é€ ä¸€ä¸ªå‡çš„è®¤è¯ URLï¼‰
//             const mockToken = "mock-" + Date.now();
//             const certifyUrl = `https://o.alicdn.com/yd-cloudauth/demo.html?token=${mockToken}`;

//             const resultBox = document.getElementById('result');
//             if (resultBox) {
//                 resultBox.innerHTML = `
//     <p>MetaInfo å·²ç”Ÿæˆï¼Œæ¨¡æ‹Ÿè·³è½¬è®¤è¯é¡µï¼š</p>
//     <p class="break-all text-blue-600">${certifyUrl}</p>
//     <p class="mt-2 text-emerald-600">3 ç§’åè‡ªåŠ¨è·³è½¬...</p>
//   `;
//             }

//             // âœ… 3 ç§’åè·³è½¬åˆ°é˜¿é‡Œäº‘å®äººè®¤è¯æµ‹è¯•é¡µé¢
//             setTimeout(() => {
//                 window.location.href = certifyUrl;
//             }, 3000);
            /* âœ… ç¬¬ä¸€æ­¥ï¼šè°ƒç”¨é˜¿é‡Œäº‘å®äººè®¤è¯ */
            // showToast('æ­£åœ¨è¿›è¡Œäººè„¸è¯†åˆ«è®¤è¯...', 'info');
            // const metaInfo = window.getMetaInfo();

            // // è°ƒç”¨ä½ çš„åç«¯æ¥å£è·å–è®¤è¯URLï¼ˆæ­¤æ¥å£éœ€è°ƒç”¨é˜¿é‡Œäº‘ InitFaceVerifyï¼‰
            // const verifyRes = await fetch('https://yourserver.com/api/initFaceVerify', {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify(metaInfo)
            // });
            // const verifyData = await verifyRes.json();

            // if (verifyData?.resultObject?.certifyUrl) {
            //     // è·³è½¬è‡³é˜¿é‡Œäº‘äººè„¸è®¤è¯é¡µé¢
            //     showToast('å³å°†è·³è½¬äººè„¸è®¤è¯...', 'info');
            //     window.location.href = verifyData.resultObject.certifyUrl;
            //     return; // âš ï¸ æ­¤æ—¶ä¸æ‰§è¡Œåç»­ç™»å½•é€»è¾‘ï¼Œå¾…è®¤è¯å®Œæˆåè¿”å›é¡µé¢å†ç™»å½•
            // } else {
            //     showToast('æœªèƒ½è·å–è®¤è¯é“¾æ¥ï¼Œè¯·ç¨åå†è¯•', 'error');
            // }
            try {
                const res = await fetch('https://gdclient.7919.cn/api/Login/loginOrRegister', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ account, type, code, inviterId: inviteId })
                });
                const data = await res.json();
                if (data.code == 200) {
                    showToast('ç™»å½•æˆåŠŸ', 'success');
                    location.href = '/download.html';
                } else {
                    showToast(data.msg || 'ç™»å½•å¤±è´¥', 'error');
                    btn.disabled = false;
                    btn.innerHTML = oldHtml;
                }
            } catch {
                showToast('ç½‘ç»œé”™è¯¯', 'error');
                btn.disabled = false;
                btn.innerHTML = oldHtml;
            } finally {
                btn.disabled = false;
                btn.innerHTML = oldHtml;
            }
        }

        formPhone.addEventListener('submit', e => {
            e.preventDefault();
            const btn = e.submitter; // âœ… è·å–æäº¤æŒ‰é’®
            const phone = formPhone.elements['phone'].value.trim();
            const code = formPhone.elements['code'].value.trim();
            if (!/^\d{4,6}$/.test(code)) return showToast('è¯·è¾“å…¥æ­£ç¡®éªŒè¯ç ');
            handleLogin(phone, 1, code, btn);
        });

        formEmail.addEventListener('submit', e => {
            e.preventDefault();
            const btn = e.submitter; // âœ… è·å–æäº¤æŒ‰é’®
            const email = formEmail.elements['email'].value.trim();
            const code = formEmail.elements['code'].value.trim();
            if (!/^\d{4,6}$/.test(code)) return showToast('è¯·è¾“å…¥æ­£ç¡®éªŒè¯ç ');
            handleLogin(email, 2, code, btn);
        });

        // é€šç”¨åŠ è½½æŒ‰é’®
        function setLoading(btn, text) {
            btn.disabled = true;
            btn.innerHTML = `<svg class="animate-spin w-4 h-4 inline mr-2" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
        </svg>${text}`;
        }
        function resetButton(btn, html) {
            btn.disabled = false;
            btn.innerHTML = html;
            lucide.createIcons();
        }

        const isUnderMaintenance = false; // âš™ï¸ æ”¹ä¸º true å³å¯å¯ç”¨ç»´æŠ¤æ¨¡å¼

        window.addEventListener("load", () => {
            if (isUnderMaintenance) {
                document.getElementById("maintenance-overlay").classList.remove("hidden");
                document.body.style.overflow = "hidden"; // ç¦æ­¢æ»šåŠ¨
            }
        });


        /** =============== ç¦æ­¢å¼€å‘è€…æ¨¡å¼æ£€æµ‹ =============== */

        // ç¦æ­¢å³é”®èœå•
        document.addEventListener('contextmenu', e => e.preventDefault());

        // ç¦æ­¢å¸¸è§å¿«æ·é”®
        document.addEventListener('keydown', e => {
            // F12
            if (e.key === 'F12') e.preventDefault();
            // Ctrl+Shift+I / Ctrl+Shift+J / Ctrl+U / Ctrl+S
            if (e.ctrlKey && (e.shiftKey && ['I', 'J', 'C'].includes(e.key.toUpperCase()) ||
                ['U', 'S'].includes(e.key.toUpperCase()))) {
                e.preventDefault();
            }
        });

        // å®šæœŸæ£€æµ‹å¼€å‘è€…å·¥å…·æ˜¯å¦æ‰“å¼€ï¼ˆåˆ©ç”¨æ—¶é—´å·®æ³•ï¼‰
        let devtoolsOpen = false;
        const threshold = 160;
        setInterval(() => {
            const start = performance.now();
            debugger; // è°ƒè¯•å™¨æ£€æµ‹
            const cost = performance.now() - start;
            if (cost > threshold) {
                devtoolsOpen = true;
                maintenanceOverlay.classList.remove('hidden');
                maintenanceOverlay.querySelector('h2').textContent = 'è­¦å‘Šï¼šç¦æ­¢æ‰“å¼€å¼€å‘è€…å·¥å…·';
                maintenanceOverlay.querySelector('p').innerHTML = 'æ£€æµ‹åˆ°å¼€å‘è€…å·¥å…·å·²å¼€å¯ï¼Œä¸ºä¿æŠ¤ç³»ç»Ÿå®‰å…¨ï¼Œè®¿é—®å·²è¢«ä¸´æ—¶é”å®šã€‚';
                document.body.style.overflow = 'hidden';
            }
        }, 1000);

        // é€šè¿‡ console å¤§å°å˜åŒ–æ£€æµ‹æ§åˆ¶å°
        const checkConsole = () => {
            const threshold = 160;
            const widthThreshold = window.outerWidth - window.innerWidth > threshold;
            const heightThreshold = window.outerHeight - window.innerHeight > threshold;
            if (widthThreshold || heightThreshold) {
                maintenanceOverlay.classList.remove('hidden');
                maintenanceOverlay.querySelector('h2').textContent = 'è­¦å‘Šï¼šå¼€å‘è€…æ¨¡å¼å·²å¯ç”¨';
                maintenanceOverlay.querySelector('p').innerHTML = 'è¯·å…³é—­è°ƒè¯•å™¨ååˆ·æ–°é¡µé¢ç»§ç»­è®¿é—®ã€‚';
                document.body.style.overflow = 'hidden';
            }
        };
        setInterval(checkConsole, 2000);
    </script>
    <div id="maintenance-overlay"
        class="fixed inset-0 z-[9999] hidden bg-black/70 backdrop-blur-sm flex flex-col items-center justify-center text-white">
        <img src="assets/logo.png" alt="logo" class="w-20 h-20 mb-6 rounded-2xl opacity-90" />
        <h2 class="text-2xl font-bold mb-2">ç½‘ç«™ç™»å½•ç³»ç»Ÿç»´æŠ¤ä¸­</h2>
        <p class="text-slate-200 text-center max-w-sm leading-relaxed">
            æˆ‘ä»¬æ­£åœ¨è¿›è¡Œç™»å½•ç³»ç»Ÿå‡çº§å’Œä¼˜åŒ–ï¼Œè¯·ç¨åå†è¯•ã€‚<br />
            ç»™æ‚¨å¸¦æ¥çš„ä¸ä¾¿ï¼Œæ•¬è¯·è°…è§£ ğŸ™
        </p>
        <div class="mt-6 text-sm opacity-80">
            â€” GoldenAnt æŠ€æœ¯å›¢é˜Ÿ
        </div>
    </div>
</body>

</html>